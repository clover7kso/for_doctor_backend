# Migration `20200914063601-init`

This migration has been generated by woony1 at 9/14/2020, 3:36:01 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX `postId` ON `Doctor`.`Comment`

DROP INDEX `userNickname` ON `Doctor`.`Comment`

DROP INDEX `fromNickname` ON `Doctor`.`Message`

DROP INDEX `toUserNickname` ON `Doctor`.`Message`

DROP INDEX `userNickname` ON `Doctor`.`Post`

DROP INDEX `User.nickname_unique` ON `Doctor`.`User`

DROP INDEX `productId` ON `Doctor`.`likeProduct`

DROP INDEX `userId` ON `Doctor`.`likeProduct`

ALTER TABLE `Doctor`.`Comment` DROP COLUMN `userNickname`,
ADD COLUMN `userId` varchar(191)  NOT NULL 

ALTER TABLE `Doctor`.`Message` DROP COLUMN `fromNickname`,
DROP COLUMN `toUserNickname`,
ADD COLUMN `fromname` varchar(191)  NOT NULL ,
ADD COLUMN `touserId` varchar(191)  NOT NULL 

ALTER TABLE `Doctor`.`Post` DROP COLUMN `userNickname`,
ADD COLUMN `userId` varchar(191)  NOT NULL 

ALTER TABLE `Doctor`.`User` DROP COLUMN `nickname`,
ADD COLUMN `name` varchar(191)  NOT NULL 

ALTER TABLE `Doctor`.`Comment` ADD FOREIGN KEY (`userId`) REFERENCES `Doctor`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Doctor`.`Comment` ADD FOREIGN KEY (`postId`) REFERENCES `Doctor`.`Post`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Doctor`.`Message` ADD FOREIGN KEY (`fromname`) REFERENCES `Doctor`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Doctor`.`Message` ADD FOREIGN KEY (`touserId`) REFERENCES `Doctor`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Doctor`.`Post` ADD FOREIGN KEY (`userId`) REFERENCES `Doctor`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Doctor`.`likeProduct` ADD FOREIGN KEY (`userId`) REFERENCES `Doctor`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Doctor`.`likeProduct` ADD FOREIGN KEY (`productId`) REFERENCES `Doctor`.`Product`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200914063601-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,123 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "mysql"
+  url = "***"
+}
+
+model User {
+  id        String   @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt @default(now())
+
+  avatar         String?
+  password       String
+  name           String
+  phone          String        @unique
+  medical_cate   String?
+  medical_id     String?
+  medical_certi  String?
+  permit         Boolean       @default(false)
+  email_check    Boolean       @default(false)
+  registerSecret String        @default("")
+  likeProducts   likeProduct[]
+
+  Post    Post[]    @relation("PostAuthor")
+  Comment Comment[] @relation("CommentAuthor")
+  inbox   Message[] @relation("MessageReceiver")
+  outbox  Message[] @relation("MessageSender")
+
+  @@unique([medical_id, medical_cate])
+}
+
+model Post {
+  id        String   @id @default(cuid())
+  user      User     @relation(name: "PostAuthor", fields: [userId], references: [id])
+  userId    String
+  updatedAt DateTime @updatedAt @default(now())
+  createdAt DateTime @default(now())
+
+  category   String
+  title      String
+  content    String
+  views      Int
+  todayViews Int
+  comments   Comment[]
+}
+
+model Comment {
+  id        String   @id @default(cuid())
+  user      User     @relation(name: "CommentAuthor", fields: [userId], references: [id])
+  userId    String
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt @default(now())
+
+  text   String
+  post   Post   @relation(fields: [postId], references: [id])
+  postId String
+}
+
+model Product {
+  id        String    @id @default(cuid())
+  updatedAt DateTime  @updatedAt @default(now())
+  createdAt DateTime  @default(now())
+  expireAt  DateTime?
+
+  doctor       String?
+  category     String
+  sampleImages sampleImage
+  detailImages detailImage[]
+  title        String
+  content      String        @default("")
+  views        Int
+  calls        Int
+  ad           Boolean
+  company      String
+  phone        String
+  likeProduct  likeProduct[]
+}
+
+model sampleImage {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt @default(now())
+
+  url       String
+  productId String
+  product   Product @relation(fields: [productId], references: [id])
+}
+
+model detailImage {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt @default(now())
+
+  url       String
+  productId String
+  product   Product @relation(fields: [productId], references: [id])
+}
+
+model likeProduct {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt @default(now())
+
+  userId    String
+  user      User    @relation(fields: [userId], references: [id])
+  productId String
+  product   Product @relation(fields: [productId], references: [id])
+}
+
+model Message {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  text     String
+  fromname String
+  touserId String
+  from     User   @relation("MessageSender", fields: [fromname], references: [id])
+  to       User   @relation("MessageReceiver", fields: [touserId], references: [id])
+}
```


