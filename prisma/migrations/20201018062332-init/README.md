# Migration `20201018062332-init`

This migration has been generated by woony at 10/18/2020, 3:23:32 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX `User.medical_id_medical_cate_unique` ON `User`

ALTER TABLE `Comment` DROP FOREIGN KEY `Comment_ibfk_1`

ALTER TABLE `Post` DROP FOREIGN KEY `Post_ibfk_1`

ALTER TABLE `likeProduct` DROP FOREIGN KEY `likeProduct_ibfk_1`

ALTER TABLE `Product` ADD COLUMN `marketerId` varchar(191)  

ALTER TABLE `User` DROP COLUMN `medical_id`,
    DROP COLUMN `medical_cate`,
    DROP COLUMN `medical_certi`

CREATE TABLE `User_Doctor` (
`id` varchar(191)  NOT NULL ,
`userId` varchar(191)  NOT NULL ,
`medical_cate` varchar(191)  NOT NULL ,
`medical_id` varchar(191)  NOT NULL ,
`medical_certi` varchar(191)  NOT NULL ,
UNIQUE INDEX `User_Doctor.medical_id_medical_cate_unique`(`medical_id`,
`medical_cate`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `User_Marketer` (
`id` varchar(191)  NOT NULL ,
`userId` varchar(191)  NOT NULL ,
`company_name` varchar(191)  NOT NULL ,
`company_certi` varchar(191)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `User_Doctor` ADD FOREIGN KEY (`userId`) REFERENCES `Doctor`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `User_Marketer` ADD FOREIGN KEY (`userId`) REFERENCES `Doctor`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Comment` ADD FOREIGN KEY (`userId`) REFERENCES `Doctor`.`User_Doctor`(`userId`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Post` ADD FOREIGN KEY (`userId`) REFERENCES `Doctor`.`User_Doctor`(`userId`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Product` ADD FOREIGN KEY (`marketerId`) REFERENCES `Doctor`.`User_Marketer`(`userId`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `likeProduct` ADD FOREIGN KEY (`userId`) REFERENCES `Doctor`.`User_Doctor`(`userId`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200930030100-init..20201018062332-init
--- datamodel.dml
+++ datamodel.dml
@@ -4,9 +4,9 @@
 }
 datasource db {
   provider = "mysql"
-  url = "***"
+  url = "***"
 }
 model HomeAD {
   id        String    @id @default(cuid())
@@ -25,32 +25,55 @@
   avatar         String?
   password       String
   name           String
-  phone          String        @unique
-  medical_cate   String?
-  medical_id     String?
-  medical_certi  String?
-  permit         Boolean       @default(false)
-  email_check    Boolean       @default(false)
-  registerSecret String        @default("")
-  likeProducts   likeProduct[]
+  phone          String  @unique
+  permit         Boolean @default(false)
+  email_check    Boolean @default(false)
+  registerSecret String  @default("")
-  Post    Post[]    @relation("PostAuthor")
-  Comment Comment[] @relation("CommentAuthor")
-  inbox   Message[] @relation("MessageReceiver")
-  outbox  Message[] @relation("MessageSender")
-  rooms   Room[]    @relation(name: "RoomParticipants")
+  inbox  Message[] @relation("MessageReceiver")
+  outbox Message[] @relation("MessageSender")
+  rooms  Room[]    @relation(name: "RoomParticipants")
+
+  User_Doctor   User_Doctor[]   @relation("userId")
+  User_Marketer User_Marketer[] @relation("userId")
+}
+
+model User_Doctor {
+  id     String @id @default(cuid())
+  user   User   @relation(name: "userId", fields: [userId], references: [id])
+  userId String
+
+  medical_cate  String
+  medical_id    String
+  medical_certi String
+
+  likeProducts likeProduct[]
+  Post         Post[]        @relation("PostAuthor")
+  Comment      Comment[]     @relation("CommentAuthor")
+
   @@unique([medical_id, medical_cate])
 }
+model User_Marketer {
+  id     String @id @default(cuid())
+  user   User   @relation(name: "userId", fields: [userId], references: [id])
+  userId String
+
+  company_name  String
+  company_certi String
+
+  product Product[]
+}
+
 model Post {
-  id        String   @id @default(cuid())
-  user      User     @relation(name: "PostAuthor", fields: [userId], references: [id])
+  id        String      @id @default(cuid())
+  user      User_Doctor @relation(name: "PostAuthor", fields: [userId], references: [userId])
   userId    String
-  updatedAt DateTime @default(now()) @updatedAt
-  createdAt DateTime @default(now())
+  updatedAt DateTime    @default(now()) @updatedAt
+  createdAt DateTime    @default(now())
   category   String
   title      String
   content    String
@@ -59,13 +82,13 @@
   comments   Comment[]
 }
 model Comment {
-  id        String   @id @default(cuid())
-  user      User     @relation(name: "CommentAuthor", fields: [userId], references: [id])
+  id        String      @id @default(cuid())
+  user      User_Doctor @relation(name: "CommentAuthor", fields: [userId], references: [userId])
   userId    String
-  createdAt DateTime @default(now())
-  updatedAt DateTime @default(now()) @updatedAt
+  createdAt DateTime    @default(now())
+  updatedAt DateTime    @default(now()) @updatedAt
   text   String
   post   Post   @relation(fields: [postId], references: [id])
   postId String
@@ -81,15 +104,17 @@
   subCategory  String?
   sampleImages sampleImage[]
   detailImages detailImage[]
   title        String
-  content      String        @default("")
+  content      String         @default("")
   views        Int
   calls        Int
-  aboveAD      Boolean       @default(false)
+  aboveAD      Boolean        @default(false)
   company      String
   phone        String
   likeProduct  likeProduct[]
+  Marketer     User_Marketer? @relation(fields: [marketerId], references: [userId])
+  marketerId   String?
 }
 model sampleImage {
   id        String   @id @default(cuid())
@@ -116,11 +141,11 @@
   createdAt DateTime @default(now())
   updatedAt DateTime @default(now()) @updatedAt
   userId    String
-  user      User    @relation(fields: [userId], references: [id])
+  user      User_Doctor @relation(fields: [userId], references: [userId])
   productId String
-  product   Product @relation(fields: [productId], references: [id])
+  product   Product     @relation(fields: [productId], references: [id])
 }
 model Room {
   createdAt    DateTime  @default(now())
```


